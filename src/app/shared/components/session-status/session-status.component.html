<div *ngIf="isAuthenticated && sessionInfo.isValid" 
     class="fixed bottom-4 right-4 bg-white border border-gray-200 rounded-lg shadow-lg p-4 max-w-sm z-40"
     [ngClass]="{
       'border-yellow-300 bg-yellow-50': sessionInfo.hoursRemaining <= 2,
       'border-red-300 bg-red-50': sessionInfo.hoursRemaining <= 1
     }">
  
  <!-- Titre avec indicateur de statut -->
  <div class="flex items-center justify-between mb-2">
    <h3 class="text-sm font-medium text-gray-900">Session active</h3>
    <div class="flex items-center">
      <div class="w-2 h-2 rounded-full mr-2"
           [ngClass]="{
             'bg-green-500': sessionInfo.hoursRemaining > 2,
             'bg-yellow-500': sessionInfo.hoursRemaining <= 2 && sessionInfo.hoursRemaining > 1,
             'bg-red-500': sessionInfo.hoursRemaining <= 1
           }">
      </div>
      <button (click)="toggleDetails()" 
              class="text-gray-400 hover:text-gray-600">
        <svg class="w-4 h-4 transform transition-transform" 
             [class.rotate-180]="showDetails" 
             fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Temps restant -->
  <div class="text-sm text-gray-600 mb-2">
    Temps restant: 
    <span class="font-semibold"
          [ngClass]="{
            'text-green-600': sessionInfo.hoursRemaining > 2,
            'text-yellow-600': sessionInfo.hoursRemaining <= 2 && sessionInfo.hoursRemaining > 1,
            'text-red-600': sessionInfo.hoursRemaining <= 1
          }">
      {{ formatTimeRemaining(sessionInfo.hoursRemaining) }}
    </span>
  </div>

  <!-- Barre de progression -->
  <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
    <div class="h-2 rounded-full transition-all duration-300"
         [ngClass]="{
           'bg-green-500': sessionInfo.hoursRemaining > 2,
           'bg-yellow-500': sessionInfo.hoursRemaining <= 2 && sessionInfo.hoursRemaining > 1,
           'bg-red-500': sessionInfo.hoursRemaining <= 1
         }"
         [style.width.%]="getProgressPercentage()">
    </div>
  </div>

  <!-- D√©tails √©tendus -->
  <div *ngIf="showDetails" class="border-t border-gray-200 pt-3 space-y-2">
    <div class="text-xs text-gray-500">
      <div>Connexion: {{ formatLastLogin() }}</div>
      <div>Utilisateur: {{ currentUser?.firstName }} {{ currentUser?.lastName }}</div>
      <div>R√¥le: {{ getRoleDisplayName() }}</div>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex space-x-2 mt-3">
    <button *ngIf="sessionInfo.hoursRemaining <= 2" 
            (click)="renewSession()"
            [disabled]="isRenewing"
            class="flex-1 bg-indigo-600 text-white text-xs px-3 py-1.5 rounded hover:bg-indigo-700 disabled:opacity-50 transition-colors">
      <span *ngIf="!isRenewing">üîÑ Renouveler</span>
      <span *ngIf="isRenewing">‚è≥ En cours...</span>
    </button>
    
    <button (click)="logout()"
            class="flex-1 bg-gray-200 text-gray-700 text-xs px-3 py-1.5 rounded hover:bg-gray-300 transition-colors">
      üö™ D√©connexion
    </button>
  </div>

  <!-- Alerte de session critique -->
  <div *ngIf="sessionInfo.hoursRemaining <= 1" 
       class="mt-3 p-2 bg-red-100 border border-red-300 rounded text-xs text-red-800">
    ‚ö†Ô∏è Votre session expire bient√¥t ! Renouvelez-la pour continuer √† utiliser l'application.
  </div>
</div>
